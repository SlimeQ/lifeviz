<Window x:Class="lifeviz.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="LifeViz"
        Width="1200"
        Height="675"
        Background="#0B0B0B"
        WindowStartupLocation="CenterScreen">
    <Grid x:Name="Root" Background="#0B0B0B">
        <Grid.ContextMenu>
            <ContextMenu x:Name="RootContextMenu"
                         Opened="RootContextMenu_OnOpened">
                <MenuItem x:Name="PauseMenuItem"
                          Header="Pause Simulation"
                          Click="TogglePause_Click" />
                <MenuItem Header="Randomize"
                          Click="Randomize_Click" />
                <Separator />
                <MenuItem Header="Columns">
                    <MenuItem Header="64" Click="PresetColumns_Click" />
                    <MenuItem Header="96" Click="PresetColumns_Click" />
                    <MenuItem Header="128" Click="PresetColumns_Click" />
                    <MenuItem Header="192" Click="PresetColumns_Click" />
                    <MenuItem Header="256" Click="PresetColumns_Click" />
                    <Separator />
                    <MenuItem Header="Custom..." Click="SetColumns_Click" />
                </MenuItem>
                <MenuItem Header="Depth">
                    <MenuItem Header="12" Click="PresetDepth_Click" />
                    <MenuItem Header="24" Click="PresetDepth_Click" />
                    <MenuItem Header="36" Click="PresetDepth_Click" />
                    <MenuItem Header="48" Click="PresetDepth_Click" />
                    <Separator />
                    <MenuItem Header="Custom..." Click="SetDepth_Click" />
                </MenuItem>
                <Separator />
                <MenuItem Header="Sources"
                          x:Name="SourcesMenu" />
                <MenuItem Header="Audio Source"
                          x:Name="AudioSourceMenu" />
                <Separator />
                <MenuItem x:Name="PassthroughMenuItem"
                          Header="Passthrough Underlay"
                          IsCheckable="True"
                          Click="TogglePassthrough_Click" />
                <MenuItem x:Name="PreserveResolutionMenuItem"
                          Header="Preserve Window Resolution"
                          IsCheckable="True"
                          Click="TogglePreserveResolution_Click" />
                <MenuItem x:Name="ShowFpsMenuItem"
                          Header="Show FPS"
                          IsCheckable="True"
                          Click="ToggleFps_Click" />
                <MenuItem x:Name="FullscreenMenuItem"
                          Header="Fullscreen"
                          IsCheckable="True"
                          Click="ToggleFullscreen_Click" />
                <MenuItem Header="Composite Blend"
                          x:Name="BlendModeMenu">
                    <MenuItem Header="Additive" IsCheckable="True" Click="BlendModeItem_Click" />
                    <MenuItem Header="Normal" IsCheckable="True" Click="BlendModeItem_Click" />
                    <MenuItem Header="Multiply" IsCheckable="True" Click="BlendModeItem_Click" />
                    <MenuItem Header="Screen" IsCheckable="True" Click="BlendModeItem_Click" />
                    <MenuItem Header="Overlay" IsCheckable="True" Click="BlendModeItem_Click" />
                    <MenuItem Header="Lighten" IsCheckable="True" Click="BlendModeItem_Click" />
                    <MenuItem Header="Darken" IsCheckable="True" Click="BlendModeItem_Click" />
                    <MenuItem Header="Subtractive" IsCheckable="True" Click="BlendModeItem_Click" />
                </MenuItem>
                <MenuItem x:Name="InvertCompositeMenuItem"
                          Header="Invert Composite"
                          IsCheckable="True"
                          Click="InvertComposite_Click" />
                <MenuItem Header="Life Opacity" StaysOpenOnClick="True">
                    <Slider x:Name="LifeOpacitySlider"
                            Minimum="0"
                            Maximum="1"
                            Value="1"
                            SmallChange="0.05"
                            LargeChange="0.1"
                            Width="160"
                            ValueChanged="LifeOpacitySlider_OnValueChanged" />
                </MenuItem>
                <MenuItem Header="Life Modes"
                          x:Name="LifeModeMenu">
                    <MenuItem Header="Naive Grayscale" IsCheckable="True" Click="LifeModeItem_Click" />
                    <MenuItem Header="RGB Channel Bins" IsCheckable="True" Click="LifeModeItem_Click" />
                </MenuItem>
                <MenuItem Header="Binning Mode"
                          x:Name="BinningModeMenu">
                    <MenuItem Header="Fill" IsCheckable="True" Click="BinningModeItem_Click" />
                    <MenuItem Header="Binary" IsCheckable="True" Click="BinningModeItem_Click" />
                </MenuItem>
                <MenuItem Header="Injection Mode"
                          x:Name="InjectionModeMenu">
                    <MenuItem Header="Threshold" IsCheckable="True" Click="InjectionModeItem_Click" />
                    <MenuItem Header="Random Pulse" IsCheckable="True" Click="InjectionModeItem_Click" />
                    <MenuItem Header="Pulse Width Modulation" IsCheckable="True" Click="InjectionModeItem_Click" />
                </MenuItem>
                <MenuItem Header="Capture Threshold" StaysOpenOnClick="True">
                    <StackPanel Orientation="Vertical" Margin="4">
                        <TextBlock Text="Min" Margin="0,0,0,2"/>
                        <Slider x:Name="ThresholdMinSlider"
                                Minimum="0"
                                Maximum="1"
                                Value="0.35"
                                SmallChange="0.01"
                                LargeChange="0.1"
                                Width="160"
                                ValueChanged="ThresholdSlider_OnValueChanged" />
                        <TextBlock Text="Max" Margin="0,4,0,2"/>
                        <Slider x:Name="ThresholdMaxSlider"
                                Minimum="0"
                                Maximum="1"
                                Value="0.75"
                                SmallChange="0.01"
                                LargeChange="0.1"
                                Width="160"
                                ValueChanged="ThresholdSlider_OnValueChanged" />
                        <CheckBox x:Name="InvertThresholdCheckBox"
                                  Content="Invert Window"
                                  Margin="0,6,0,0"
                                  Checked="InvertThresholdCheckBox_OnChecked"
                                  Unchecked="InvertThresholdCheckBox_OnChecked"/>
                    </StackPanel>
                </MenuItem>
                <MenuItem Header="Injection Noise" StaysOpenOnClick="True">
                    <Slider x:Name="NoiseSlider"
                            Minimum="0"
                            Maximum="1"
                            Value="0"
                            SmallChange="0.01"
                            LargeChange="0.1"
                            Width="160"
                            ValueChanged="NoiseSlider_OnValueChanged" />
                </MenuItem>
                <Separator />
                <MenuItem Header="Framerate"
                          x:Name="FramerateMenu">
                    <MenuItem Header="15 fps" IsCheckable="True" Click="FramerateItem_Click" />
                    <MenuItem Header="30 fps" IsCheckable="True" Click="FramerateItem_Click" />
                    <MenuItem Header="60 fps" IsCheckable="True" Click="FramerateItem_Click" />
                    <MenuItem Header="144 fps" IsCheckable="True" Click="FramerateItem_Click" />
                </MenuItem>
                <MenuItem Header="FPS Modulation" StaysOpenOnClick="True">
                    <StackPanel Margin="4" Width="220">
                        <CheckBox x:Name="FpsOscillationCheckBox"
                                  Content="Enable Oscillation"
                                  Margin="0,0,0,4"
                                  Checked="FpsOscillation_OnChecked"
                                  Unchecked="FpsOscillation_OnChecked"/>
                        <CheckBox x:Name="AudioSyncCheckBox"
                                  Content="Sync to Audio BPM"
                                  Margin="0,0,0,8"
                                  Checked="AudioSync_OnChecked"
                                  Unchecked="AudioSync_OnChecked"/>
                        
                        <DockPanel Margin="0,0,0,4">
                            <TextBlock Text="BPM:" DockPanel.Dock="Left"/>
                            <TextBlock x:Name="BpmValueText" Text="140" DockPanel.Dock="Right" FontWeight="Bold"/>
                            <Slider x:Name="BpmSlider"
                                    Minimum="40"
                                    Maximum="240"
                                    Value="140"
                                    SmallChange="1"
                                    LargeChange="10"
                                    Margin="8,0"
                                    ValueChanged="BpmSlider_OnValueChanged"/>
                        </DockPanel>
                        
                        <DockPanel Margin="0,0,0,4">
                            <TextBlock Text="Min FPS:" DockPanel.Dock="Left"/>
                            <TextBlock x:Name="MinFpsValueText" Text="30" DockPanel.Dock="Right" FontWeight="Bold"/>
                            <Slider x:Name="MinFpsSlider"
                                    Minimum="1"
                                    Maximum="144"
                                    Value="30"
                                    SmallChange="1"
                                    LargeChange="5"
                                    Margin="8,0"
                                    ValueChanged="OscillationRange_OnValueChanged"/>
                        </DockPanel>

                        <DockPanel>
                            <TextBlock Text="Max FPS:" DockPanel.Dock="Left"/>
                            <TextBlock x:Name="MaxFpsValueText" Text="60" DockPanel.Dock="Right" FontWeight="Bold"/>
                            <Slider x:Name="MaxFpsSlider"
                                    Minimum="1"
                                    Maximum="144"
                                    Value="60"
                                    SmallChange="1"
                                    LargeChange="5"
                                    Margin="8,0"
                                    ValueChanged="OscillationRange_OnValueChanged"/>
                        </DockPanel>
                    </StackPanel>
                </MenuItem>
            </ContextMenu>
        </Grid.ContextMenu>

        <Viewbox Stretch="Uniform"
                 HorizontalAlignment="Center"
                 VerticalAlignment="Center">
            <Border Background="Black"
                    Padding="0"
                    SnapsToDevicePixels="True">
                <Image x:Name="GameImage"
                       RenderOptions.BitmapScalingMode="NearestNeighbor"
                       RenderOptions.EdgeMode="Aliased"
                       SnapsToDevicePixels="True" />
            </Border>
        </Viewbox>

        <TextBlock x:Name="FpsText"
                   Margin="8"
                   HorizontalAlignment="Left"
                   VerticalAlignment="Top"
                   FontSize="14"
                   FontWeight="Bold"
                   Foreground="White"
                   Visibility="Collapsed"
                   Text="FPS" />
    </Grid>
</Window>
